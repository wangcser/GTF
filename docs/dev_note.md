# 开发日志

## 2019.05.26 完成 GTF 核心模块的骨架开发

**上午**

上午花了一个小时时间解决了本地合约开发、部署和调用的问题，总结如下：

- 合约开发可以利用本地的 vscode 完成，能够检查语法错误，但是无法进行编译检查
- 部署使用 truffle develop 提供的私有链，借助 ganache 也能额完成，但是不方便后面的调用调试
- 调试要使用 web3 封装的 rpc 接口，这一点在测试的时候会用到

下一步工作的建议：

1. FT 合约上可以再次进行解耦操作，但是现在进行这样的设计可能还比较早（开发流程、环境、BUG 都还在梳理中），因此就行这样，先保证能用，等三个合约都初步开发完了就将 metadata 等模块解耦和
2. safemath 可以以 lib 的形式存在
3. 下一步先完成 nft 核心模块的开发，然后是 sft 核心模块的开发
4. 看今天工作的进度吧，完成得快的化写一个界面来演示目前的工作

想把开发工作换到 remix 上来，但是发现本地环境一直都搞不定，主要问题在于：

1. node 环境
2. remix 代码变迁太快

上午工作总结：

- 完成了
  - FT 基本核心模块的开发
  - NFT 基本核心模块的开发
- 新的经验：
  - 对于查询类接口需要给出明确的返回值，这一点在后面的设计中要改进
  - 对于权限检查目前先写到方法内，后期解耦到 safe 模块中
  - 目前只支持了简单的操作，对于复杂的操作的支持需要引入复杂的状态，因此先不考虑这些操作和接口
  - 代码的宏观设计和重构需要不断地进行，因此前期的考虑不周是很正常的
  - 虽然代币合约比较简单，但是写出鲁棒且优雅的代码还是很锻炼人的，因此在月底前争取将项目的代码水平提升到主流程基本鲁棒的程度
- 下午首先完成 SFT 的开发
- 然后考虑优化一下三种代币合约的相互影响
- 最后看看有没有什么方便的前端工具来帮助代币合约的可视化（docker）
- 尽量把晚上的时间解放出来，一方面是整理前面的工作，另一方面是继续 DSA 的学习
- 时间紧迫

**下午**

- 完成
  - SFT 核心功能的开发，每个接口内部的逻辑还有待优化

到目前为止 GTF 的骨架搭建起来了，下一步的工作从两个方面入手：

1. 外部，优化模块设计
2. 内部，实现每个接口的功能

目前遇到的难点来自两个方面：

- 如何维护列表状态，如何在函数中返回列表
- 能否直接返回映射？

上面的两个难点目前还可以绕过不管，但是后期为了功能上的完善还是需要解决的，否则就要针对部分接口选择其他的接口设计方案

**夜间**

- 总结目前的工作
- 下一步的工作重点在于开始优化核心模块的功能和安全性，预计使用 2 天的时间完成

## 2019.06.01 完成 FT NFT 的核心功能的开发

- 完成了 FT 和 NFT 的功能设计
- 明天完成 SFT 的功能设计，并调整一下整体的代码和接口

## 2019.06.02 完成 GTF 核心模块的功能开发

1. 完成了 SFT 的核心功能
2. 从统一 API 的角度尽量将三种合约的 API 做到了统一，下一步就可以抽象出 core  的 API 了，同时隐藏了相关的本地接口
3. 目前只能确保三种合约的核心功能在正常操作流程和逻辑下工作正常，下一步需要考 虑异常输入和边界条件等问题
4. 下一步需要根据当前的工作优化一下项目结构，总结并更新已有的工作
5. 完成上面的工作后为项目打上 tag: GTF-v-0.1.0

**下午**
在总结本周工作的时候发现了一些可以优化的地方，现在总结如下：
1. 对于接口来说，我们可以抽象出一个 Token 类
2. 在 FT 中对 _allowed 状态的命名和其他合约中的不一样，需要修正这个问题
3. 是否需要增加一个代币类型字段来区分三种合约？那么应该在哪个层次上使用？